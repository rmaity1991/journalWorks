#include<stdio.h>
#include<stdlib.h>
#include<math.h>

#define FEATURES 5
#define SAMPLES  100

float X[SAMPLES][FEATURES]={{-4.03784632e-02,  1.56412491e+00,  2.37495729e+00,
        -5.14423122e-01, -3.61334403e-01},
       { 3.78315361e-01, -5.11457609e-01, -2.61254429e+00,
         1.18023335e+00, -9.96531884e-01},
       { 7.86931129e-01, -1.79313031e+00,  2.75607541e-03,
        -9.12585243e-01,  2.06896767e+00},
       {-1.34837415e+00, -3.26411625e-01, -1.99309734e-01,
        -5.59810756e-02,  2.55309298e-01},
       {-4.56026870e-01,  1.70164374e-01, -2.91093480e+00,
         1.69103670e+00, -1.96353766e+00},
       { 1.15117917e+00,  8.53304085e-01,  1.77939054e+00,
        -5.47290923e-01,  9.65741118e-02},
       { 4.54814264e-01,  3.33387641e-01, -7.56725085e-01,
         5.86515255e-01, -8.43802428e-01},
       {-7.12076836e-01,  2.04785183e-01, -3.05825828e+00,
         1.78983538e+00, -2.09289840e+00},
       { 6.15646109e-01,  1.01387537e+00, -8.24723171e-01,
         9.69744367e-01, -1.66961922e+00},
       {-1.11908504e+00,  2.21849198e+00,  1.30524165e-01,
         1.05523861e+00, -2.47844556e+00},
       {-4.96608428e-01, -1.57076703e+00,  1.46824670e-01,
        -8.79019502e-01,  1.90007608e+00},
       { 3.00418553e+00,  5.20755888e-01, -8.29670367e-01,
         7.21923830e-01, -1.10410696e+00},
       {-6.71743044e-01,  1.64369052e+00,  9.17736582e-01,
         3.29258794e-01, -1.33780770e+00},
       {-6.18470687e-01, -1.70108519e+00, -6.96703394e-01,
        -4.80259168e-01,  1.53817674e+00},
       { 2.13356523e-02, -1.94486461e+00,  4.50901949e-02,
        -1.01301505e+00,  2.26960456e+00},
       { 1.41058811e+00, -1.47440098e-01,  7.69226982e-01,
        -4.98929095e-01,  6.37014534e-01},
       { 6.87632520e-01,  2.14326062e-01,  5.42504903e-01,
        -1.90145697e-01,  8.22825785e-02},
       {-7.98035434e-01, -6.68994985e-01, -9.72201089e-01,
         1.95993410e-01,  1.81016479e-01},
       {-2.55611218e-01, -2.10770186e+00, -1.48867620e+00,
        -2.50301006e-01,  1.52612254e+00},
       {-4.65770340e-01,  3.86392291e-01,  7.62864210e-01,
        -2.24188534e-01,  1.76977208e-02},
       {-2.84387976e-01, -4.38961369e-01,  1.82295028e+00,
        -1.22788527e+00,  1.61286994e+00},
       {-3.43852396e-01, -6.57451076e-01,  1.01423273e+00,
        -8.93112149e-01,  1.37375829e+00},
       { 1.47810051e-01,  1.34419183e+00,  5.72399835e-01,
         3.67445485e-01, -1.20218562e+00},
       { 1.42387584e-01,  1.20595037e-01,  1.01019164e+00,
        -4.95569561e-01,  4.74297832e-01},
       {-9.67076764e-01,  4.32442497e-01,  6.28214008e-01,
        -1.26568545e-01, -1.17145438e-01},
       {-2.66407268e-01, -1.21281501e+00, -2.28526100e+00,
         6.43476292e-01,  1.07688577e-02},
       {-2.31004469e+00, -1.81155066e+00, -1.02197078e+00,
        -3.57089893e-01,  1.46804800e+00},
       { 4.45257311e-01, -1.33498052e+00,  1.74185632e-01,
        -7.74301497e-01,  1.64485059e+00},
       { 8.82873941e-01,  3.45615601e-01,  1.25476249e+00,
        -5.16052989e-01,  3.63361973e-01},
       { 5.64139229e-01, -1.75304499e+00, -2.32735828e+00,
         3.92197560e-01,  6.08039224e-01},
       {-1.26071353e+00,  1.24261728e+00, -1.68366576e+00,
         1.55943528e+00, -2.45483662e+00},
       {-3.32731006e-01, -2.51478413e+00, -5.12108495e-01,
        -9.95442165e-01,  2.58836334e+00},
       {-5.91361761e-01,  2.27662941e+00,  9.97622139e-01,
         6.06811882e-01, -2.01901896e+00},
       { 5.07086756e-01,  1.16704602e-01,  1.53770824e+00,
        -7.88326285e-01,  7.99061478e-01},
       { 2.39475076e+00, -1.95154884e+00,  4.13597921e-01,
        -1.21954169e+00,  2.50104793e+00},
       {-2.91164419e-01, -2.05968111e+00,  1.62579161e-01,
        -1.13611460e+00,  2.47330883e+00},
       { 9.94529006e-02, -1.73163181e+00, -1.37503876e+00,
        -1.21864473e-01,  1.16154681e+00},
       { 6.54070316e-01,  1.12223565e+00, -1.68209374e-01,
         6.62914352e-01, -1.39594923e+00},
       { 1.30153236e+00, -1.41922861e+00,  4.24494929e-01,
        -9.55083447e-01,  1.89395365e+00},
       { 1.43695338e+00,  1.63350247e+00,  9.30129770e-02,
         7.78690188e-01, -1.82678766e+00},
       {-1.59411393e+00, -1.34941848e+00, -3.81439461e-01,
        -4.75363106e-01,  1.32415180e+00},
       { 1.33855618e-01,  1.24163543e+00, -1.04449151e+00,
         1.20660795e+00, -2.06563403e+00},
       { 5.37606385e-01,  2.37366174e+00,  9.29694787e-01,
         6.93555953e-01, -2.17212889e+00},
       {-8.27643715e-01,  1.33373968e+00, -8.12376737e-01,
         1.12545758e+00, -2.03089372e+00},
       {-6.27509650e-01,  1.98720311e+00,  1.19177668e-01,
         9.43978232e-01, -2.21868230e+00},
       { 1.52453777e-01, -1.01916606e+00, -1.07361583e+00,
         7.39783548e-02,  5.23154304e-01},
       {-3.28370169e-01, -1.19347654e+00,  7.78108194e-01,
        -1.03530205e+00,  1.84837885e+00},
       { 8.34359174e-02, -1.64178013e+00, -2.31585195e+00,
         4.42387213e-01,  4.86748302e-01},
       { 1.18383018e+00,  1.06702817e+00,  1.78067219e+00,
        -4.39406995e-01, -1.49049567e-01},
       {-3.36366589e+00,  8.09661304e-01,  4.98682438e-01,
         1.36492357e-01, -6.30684098e-01},
       {-1.30442699e+00, -1.56839488e+00, -6.29171258e-01,
        -4.50066321e-01,  1.42620020e+00},
       { 1.74667713e+00,  9.32160337e-01,  2.22170338e-02,
         4.61371887e-01, -1.06119581e+00},
       {-1.17161302e+00, -2.13366752e+00, -2.11488345e+00,
         8.16869214e-02,  1.17586050e+00},
       {-5.89659937e-02,  1.70277111e-01,  1.19604982e+00,
        -5.72776324e-01,  5.29862148e-01},
       {-6.23596131e-01,  7.38013192e-01,  1.30664327e+00,
        -3.45278868e-01, -5.75328953e-02},
       { 1.18477081e+00, -7.82216461e-01,  1.72845792e-01,
        -4.92710764e-01,  1.00675715e+00},
       {-2.07661124e+00,  5.56761073e-02, -2.31767871e+00,
         1.30584945e+00, -1.47135280e+00},
       {-1.28676015e-01, -2.21860368e+00, -2.30564171e-01,
        -1.00015087e+00,  2.41783568e+00},
       {-6.30474695e-01, -4.78777756e-01,  1.20808064e+00,
        -9.09184283e-01,  1.28545991e+00},
       { 4.23446821e-01, -5.04552995e-01,  7.98260751e-01,
        -6.96377604e-01,  1.06635655e+00},
       {-6.09182117e-01, -1.45684492e+00, -1.17441446e+00,
        -9.28378683e-02,  9.66553634e-01},
       { 1.32458843e-01,  1.84258223e+00,  2.17721631e-01,
         8.16178417e-01, -1.99211899e+00},
       { 1.64120602e+00, -5.48338960e-01,  1.08600342e+00,
        -8.77235469e-01,  1.29153839e+00},
       {-8.25298739e-01, -9.03135906e-01,  1.32758410e-01,
        -5.32051206e-01,  1.12182600e+00},
       { 1.09202247e-01,  1.33315344e+00,  1.53510778e+00,
        -1.68831121e-01, -6.04957450e-01},
       { 9.38236409e-01, -4.59720107e-01,  1.56711240e+00,
        -1.09740842e+00,  1.48147228e+00},
       { 6.14980675e-01,  3.16903734e-01, -1.91099774e+00,
         1.21440330e+00, -1.52560754e+00},
       {-1.51826937e+00,  1.61754895e+00, -8.11026671e-02,
         8.66561209e-01, -1.91410811e+00},
       {-4.80627058e-02, -1.36062288e+00, -1.67159475e+00,
         2.30109215e-01,  5.53759673e-01},
       { 7.17037613e-02,  1.44538079e+00,  2.98686636e+00,
        -9.12054684e-01,  1.47082044e-01},
       {-7.85533861e-01, -5.41290397e-01,  1.19752710e+00,
        -9.35128765e-01,  1.35112302e+00},
       {-1.08295060e+00,  4.44785788e-01, -1.47206930e+00,
         1.03743041e+00, -1.40654973e+00},
       {-8.60444047e-01,  5.65877209e-02, -1.02363310e+00,
         5.93003060e-01, -6.86732177e-01},
       {-2.52668286e-01,  5.13865629e-01,  1.26504334e+00,
        -4.36234409e-01,  1.75628993e-01},
       { 9.94287106e-01, -2.19825923e+00, -1.49927324e+00,
        -2.90470670e-01,  1.62409192e+00},
       { 1.14796313e+00,  1.41822778e+00,  3.10566140e-01,
         5.49391314e-01, -1.44651211e+00},
       { 6.43711478e-01,  7.78850195e-01, -3.23301724e-01,
         5.73935395e-01, -1.09422456e+00},
       { 3.84185264e-01,  1.53385597e+00,  1.61909581e+00,
        -1.13153052e-01, -7.85353961e-01},
       {-2.44603269e+00,  2.26550323e+00,  1.23041004e+00,
         4.72840435e-01, -1.86485592e+00},
       { 5.70668263e-01, -1.00469882e+00, -5.36651212e-01,
        -2.14659051e-01,  8.32489746e-01},
       { 1.80289345e-01, -8.68044262e-01, -5.49550691e-01,
        -1.38116149e-01,  6.67109290e-01},
       {-3.68413977e-02, -2.39828247e+00, -2.78392138e+00,
         3.16029588e-01,  1.07473209e+00},
       {-7.44004290e-01,  1.35080167e+00, -1.31176887e+00,
         1.40940370e+00, -2.35376721e+00},
       {-3.37954373e-01,  6.50666200e-01, -7.20008003e-02,
         3.70283575e-01, -7.93865863e-01},
       {-4.99019896e-01,  1.35861977e-02,  1.48936747e+00,
        -8.14072782e-01,  8.88596571e-01},
       {-5.83870386e-01,  1.35099502e+00,  1.70651571e+00,
        -2.54250291e-01, -5.21457705e-01},
       {-3.25538831e-01,  1.12342402e+00,  1.44137075e+00,
        -2.23721754e-01, -4.20072895e-01},
       {-4.22151018e-01, -5.66141013e-01, -1.21720961e+00,
         3.83306854e-01, -8.63189236e-02},
       { 1.12203837e+00,  1.32757655e+00,  1.44908462e+00,
        -1.24246600e-01, -6.50756288e-01},
       { 7.26018556e-01,  1.45787965e+00,  6.80028872e-01,
         3.65881023e-01, -1.26790966e+00},
       { 7.37481744e-01,  6.59335570e-01, -2.46477853e+00,
         1.69364593e+00, -2.25662064e+00},
       { 2.12985675e-01, -6.15883011e-02, -2.75424649e+00,
         1.48691577e+00, -1.60121841e+00},
       {-9.70907036e-01, -3.18316354e+00, -1.33377151e+00,
        -8.82116253e-01,  2.86006836e+00},
       {-1.37815886e+00, -3.60515301e-01,  3.12915941e-01,
        -3.55660017e-01,  6.05621903e-01},
       {-3.38268077e-01,  4.37844181e-01,  1.31668743e+00,
        -5.03327395e-01,  2.94629266e-01},
       { 1.40751330e-01, -2.33775385e+00, -8.99912039e-01,
        -6.91728605e-01,  2.14881321e+00},
       {-1.43202411e+00, -2.02609652e+00, -2.03006792e+00,
         8.95899455e-02,  1.10333744e+00},
       { 1.38973047e+00,  3.09628878e-01, -4.56528554e-01,
         4.08968074e-01, -6.34148596e-01},
       { 2.07266313e+00, -7.51102387e-01,  7.52383135e-01,
        -7.96357258e-01,  1.32274827e+00},
       { 4.46253407e-01, -2.55702609e-01, -2.94403044e-01,
         3.23630062e-02,  1.16053791e-01}
};

float Y[SAMPLES]=
    {1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1,
       1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1,
       1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1,
       0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0,
       1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0};


/*********************************************************************************************************/
float * getRow(float arr[SAMPLES][FEATURES],int row){
    float *data=(float*)malloc(sizeof(float)*FEATURES);
    for(int i=0;i<FEATURES;i++){
        data[i]=arr[row][i];
    }
    return data;
}

float * getCol(float arr[SAMPLES][FEATURES],int col){
    float *data=(float*)malloc(sizeof(float)*SAMPLES);
    for(int i=0;i<SAMPLES;i++){
        data[i]=arr[i][col];
    }
    return data;
}

float sigmoid(float data){
    float exp=2.718281828;
    float result=1/(1+pow(exp,(-data)));

    if (result<0.5){
        return 0;
    }
    else if (result>=0.5){
      return 1;
    }
}

float predict(float *X,float *coeff,float bias){
    float sum=0.0;
    for(int i=0;i<FEATURES;i++){
        sum+=X[i]*coeff[i];
    }
    return sum+bias;
}

float summation(float * data){
    float sum=0;
    for(int i=0;i<SAMPLES;i++){
        sum+=data[i];
    }
    return sum;
}

void display(float *data,int count){
    for(int i=0;i<count;i++){
        printf("%f \t",data[i]);
    }
    printf("\n ----------------------------------------------------- \n");
}

float accuracy_score(float * Y, float * Y_pred){
    float correct=0;
    for(int i=0;i<SAMPLES;i++){
        if(Y[i]==Y_pred[i]){
            correct+=1;
        }
    }
    printf("The accuracy score is : %f \n",(correct/SAMPLES)*100);
    return (correct/SAMPLES)*100;
}

void LogisticRegression(float lr,int iter){
    float *coeff=(float*)malloc(sizeof(float)*FEATURES);
    for(int i=0;i<FEATURES;i++){
        coeff[i]=0;
    }
    float bias=0;
    float *y_pred=(float*)malloc(sizeof(float)*SAMPLES);
    float *error=(float*)malloc(sizeof(float)*SAMPLES);
    float *dw=(float*)malloc(sizeof(float)*FEATURES);
    float db;
    float *temp1=(float*)malloc(sizeof(float)*FEATURES);
    float *temp2=(float*)malloc(sizeof(float)*SAMPLES);
    for(int a=0;a<=iter;a++){
        for(int b=0;b<SAMPLES;b++){
            temp1=getRow(X,b);
            y_pred[b]=sigmoid(predict(temp1,coeff,bias));
            error[b]=Y[b]-y_pred[b];
            // error[b]=-(Y[b]*log(y_pred[b]))+((1.0-Y[b])*log(1.0-y_pred[b]));
        }

        for(int c=0;c<FEATURES;c++){
            temp2=getCol(X,c);
            float sum=0;
            for(int d=0;d<SAMPLES;d++){
                sum+=error[d]*temp2[d];
            }
            dw[c]=sum/SAMPLES;
            coeff[c]+=(lr*dw[c]);
        }

        db=summation(error)/SAMPLES;
        bias+=(lr*db);
        
    }
    display(y_pred,SAMPLES);
    accuracy_score(Y,y_pred);
}

int main(){
    LogisticRegression(0.01,500);
}

//(-Y * log(Y_Pred) + (1 - Y) * log(1 - Y_Pred))